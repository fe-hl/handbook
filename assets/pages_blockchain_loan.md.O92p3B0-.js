import{_ as i,c as a,o as n,ao as l}from"./chunks/framework.DOhyS95j.js";const h="/handbook/assets/loan.BnsDgiWg.png",y=JSON.parse('{"title":"ğŸ”— å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®ï¼šæµç¨‹ã€æ”¶ç›Šä¸æŠ€æœ¯å®ç°","description":"","frontmatter":{},"headers":[],"relativePath":"pages/blockchain/loan.md","filePath":"pages/blockchain/loan.md"}'),t={name:"pages/blockchain/loan.md"};function k(p,s,e,r,E,d){return n(),a("div",null,s[0]||(s[0]=[l('<h1 id="ğŸ”—-å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®-æµç¨‹ã€æ”¶ç›Šä¸æŠ€æœ¯å®ç°" tabindex="-1">ğŸ”— å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®ï¼šæµç¨‹ã€æ”¶ç›Šä¸æŠ€æœ¯å®ç° <a class="header-anchor" href="#ğŸ”—-å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®-æµç¨‹ã€æ”¶ç›Šä¸æŠ€æœ¯å®ç°" aria-label="Permalink to &quot;ğŸ”— å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®ï¼šæµç¨‹ã€æ”¶ç›Šä¸æŠ€æœ¯å®ç°&quot;">â€‹</a></h1><h2 id="_1-â›“ï¸-å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®æ¦‚è¿°" tabindex="-1">1 â›“ï¸ å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®æ¦‚è¿° <a class="header-anchor" href="#_1-â›“ï¸-å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®æ¦‚è¿°" aria-label="Permalink to &quot;1 â›“ï¸ å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®æ¦‚è¿°&quot;">â€‹</a></h2><p>ä¸ä¼ ç»Ÿé‡‘èä¸åŒï¼ŒDeFi å€Ÿè´·æ˜¯<strong>ç‚¹å¯¹åˆçº¦</strong>çš„ï¼Œæ— éœ€ä¸­ä»‹ã€‚ç”¨æˆ·ç›´æ¥ä¸æ™ºèƒ½åˆçº¦äº¤äº’ï¼Œ<strong>å­˜å…¥èµ„äº§ä»¥èµšå–åˆ©æ¯ï¼Œæˆ–æä¾›è¶…é¢æŠµæŠ¼å“ä»¥å€Ÿå‡ºèµ„äº§</strong>ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š</p><ul><li><strong>æ— è®¸å¯æ€§</strong>ï¼šä»»ä½•äººã€ä»»ä½•åœ°æ–¹å‡å¯å‚ä¸ã€‚</li><li><strong>é€æ˜æ€§</strong>ï¼šæ‰€æœ‰äº¤æ˜“å’Œåˆ©ç‡åœ¨é“¾ä¸Šå…¬å¼€å¯æŸ¥ã€‚</li><li><strong>å¯ç»„åˆæ€§</strong>ï¼šå¯ä½œä¸ºå…¶ä»– DeFi åº”ç”¨ï¼ˆå¦‚æ æ†äº¤æ˜“ã€æ”¶ç›Šå†œåœºï¼‰çš„åŸºç¡€ä¹é«˜ç§¯æœ¨ã€‚</li></ul><h2 id="_2-ğŸ”„-æ ¸å¿ƒä¸šåŠ¡æµç¨‹" tabindex="-1">2 ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹ <a class="header-anchor" href="#_2-ğŸ”„-æ ¸å¿ƒä¸šåŠ¡æµç¨‹" aria-label="Permalink to &quot;2 ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹&quot;">â€‹</a></h2><p>ä¸€ä¸ªå®Œæ•´çš„å€Ÿè´·æµç¨‹æ¶‰åŠå¤šæ–¹å‚ä¸å’Œå¤æ‚çš„é“¾ä¸Šäº¤äº’ï¼Œå…¶æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸èµ„é‡‘æµè½¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="'+h+`" alt="å€Ÿè´·"></p><h3 id="_2-1-å­˜æ¬¾æµç¨‹" tabindex="-1">2.1 å­˜æ¬¾æµç¨‹ <a class="header-anchor" href="#_2-1-å­˜æ¬¾æµç¨‹" aria-label="Permalink to &quot;2.1 å­˜æ¬¾æµç¨‹&quot;">â€‹</a></h3><ol><li><strong>ç”¨æˆ·æˆæƒ</strong>ï¼šç”¨æˆ·é¦–å…ˆæˆæƒå€Ÿè´·åˆçº¦ï¼ˆå¦‚ <code>LendingPool</code>ï¼‰æ“ä½œå…¶ä»£å¸ï¼ˆå¦‚ USDCï¼‰ã€‚è¿™æ˜¯ä¸€ç¬”ç‹¬ç«‹çš„äº¤æ˜“ã€‚</li><li><strong>æ‰§è¡Œå­˜æ¬¾</strong>ï¼šç”¨æˆ·è°ƒç”¨åˆçº¦çš„ <code>deposit()</code> æ–¹æ³•ã€‚åˆçº¦å°†ä»£å¸ä»ç”¨æˆ·é’±åŒ…è½¬ç§»è‡³åˆçº¦æœ¬èº«ï¼ˆèµ„é‡‘æ± ï¼‰ï¼Œå¹¶<strong>é“¸é€ è®¡æ¯å‡­è¯ä»£å¸ï¼ˆInterest Bearing Tokenï¼‰</strong> ç»™ç”¨æˆ·ï¼Œå¦‚<code>cUSDC</code>æˆ–<code>aUSDC</code>ã€‚</li><li><strong>å‡­è¯ä»£å¸</strong>ï¼šè¿™äº›å‡­è¯ä»£å¸æ˜¯<strong>ç”¨æˆ·çš„æœ¬é‡‘å’Œåº”è®¡åˆ©æ¯çš„æ‰€æœ‰æƒè¯æ˜</strong>ã€‚å®ƒä»¬æœ¬èº«æ˜¯ ERC-20 ä»£å¸ï¼Œå¯ä»¥è½¬ç§»ã€äº¤æ˜“ï¼Œç”šè‡³ç”¨äºå…¶ä»– DeFi åè®®ï¼ˆå¯ç»„åˆæ€§ï¼‰ã€‚</li><li><strong>å¼€å§‹è®¡æ¯</strong>ï¼šä»æ­¤åˆ»èµ·ï¼Œç”¨æˆ·çš„å­˜æ¬¾å¼€å§‹æ ¹æ®èµ„é‡‘æ± çš„<strong>å½“å‰åˆ©ç‡</strong>ç´¯ç§¯åˆ©æ¯ã€‚å…¶å‡­è¯ä»£å¸çš„ä½™é¢ä¼šéšæ—¶é—´å¢åŠ ï¼ˆæˆ–å•ä½å‡­è¯ä»£è¡¨çš„åº•å±‚èµ„äº§å¢åŠ ï¼‰ã€‚</li></ol><h3 id="_2-2-å€Ÿæ¬¾æµç¨‹" tabindex="-1">2.2 å€Ÿæ¬¾æµç¨‹ <a class="header-anchor" href="#_2-2-å€Ÿæ¬¾æµç¨‹" aria-label="Permalink to &quot;2.2 å€Ÿæ¬¾æµç¨‹&quot;">â€‹</a></h3><ol><li><strong>è¶…é¢æŠµæŠ¼</strong>ï¼šå€Ÿæ¬¾äººå¿…é¡»é¦–å…ˆå­˜å…¥æŸç§<strong>æŠµæŠ¼èµ„äº§</strong>ï¼ˆå¦‚ ETHï¼‰ã€‚å€Ÿæ¬¾é¢åº¦ç”±æŠµæŠ¼ç‰©çš„ä»·å€¼å’Œè¯¥èµ„äº§çš„<strong>è´·æ¬¾ä»·å€¼æ¯”ï¼ˆLTVï¼‰</strong> å†³å®šã€‚ä¾‹å¦‚ï¼Œå­˜å…¥ä»·å€¼$100 çš„ ETHï¼ˆLTV=75%ï¼‰ï¼Œæœ€å¤šå¯å€Ÿå‡º$75 çš„å…¶ä»–èµ„äº§ã€‚</li><li><strong>æ‰§è¡Œå€Ÿæ¬¾</strong>ï¼šå€Ÿæ¬¾äººè°ƒç”¨ <code>borrow()</code> æ–¹æ³•ï¼ŒæŒ‡å®šå€Ÿæ¬¾èµ„äº§å’Œæ•°é‡ã€‚åˆçº¦ä¼šæ£€æŸ¥å€Ÿæ¬¾äººçš„å¥åº·å› å­æ˜¯å¦å®‰å…¨ã€‚</li><li><strong>å¥åº·å› å­ï¼ˆHealth Factorï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œä»£è¡¨æŠµæŠ¼èµ„äº§çš„ä»·å€¼ä¸å€Ÿæ¬¾èµ„äº§ä»·å€¼çš„æ¯”ç‡ã€‚<strong>å¦‚æœè¯¥å€¼ä½äº 1ï¼Œå€Ÿæ¬¾äººçš„å¤´å¯¸å°†è¢«æ¸…ç®—</strong>ã€‚ <code>å¥åº·å› å­ = (æŠµæŠ¼ç‰©ä»·å€¼ * æ¸…ç®—é˜ˆå€¼) / å€Ÿæ¬¾ä»·å€¼</code></li><li><strong>æ”¯ä»˜åˆ©æ¯</strong>ï¼šå€Ÿæ¬¾åˆ©æ¯é€šå¸¸æ˜¯<strong>æµ®åŠ¨çš„</strong>ï¼Œæ ¹æ®èµ„äº§çš„éœ€æ±‚å®æ—¶å˜åŒ–ã€‚åˆ©æ¯ä»å€Ÿæ¬¾äººçš„æœªå¿è¿˜å€ºåŠ¡ä¸­ç´¯ç§¯ã€‚</li></ol><h3 id="_2-3-æ¸…ç®—æµç¨‹" tabindex="-1">2.3 æ¸…ç®—æµç¨‹ <a class="header-anchor" href="#_2-3-æ¸…ç®—æµç¨‹" aria-label="Permalink to &quot;2.3 æ¸…ç®—æµç¨‹&quot;">â€‹</a></h3><p>å½“æŠµæŠ¼ç‰©ä»·å€¼ä¸‹è·Œæˆ–å€Ÿæ¬¾ä»·å€¼ä¸Šæ¶¨å¯¼è‡´<strong>å¥åº·å› å­ä½äº 1</strong>æ—¶ï¼Œä»»ä½•æ¸…ç®—äººéƒ½å¯ä»¥è°ƒç”¨ <code>liquidate()</code> å‡½æ•°ã€‚</p><ul><li>æ¸…ç®—äººä»¥æŠ˜æ‰£ä»·è´­ä¹°æŠµæŠ¼èµ„äº§ï¼ˆå¦‚ä»¥$95 çš„ä»·æ ¼è´­ä¹°ä»·å€¼$100 çš„æŠµæŠ¼ ETHï¼‰ï¼Œå·®ä»·ä½œä¸ºåˆ©æ¶¦ã€‚</li><li>å€Ÿæ¬¾äººçš„éƒ¨åˆ†æˆ–å…¨éƒ¨å€ºåŠ¡è¢«å¿è¿˜ï¼Œåè®®é€šå¸¸ä¼šå¯¹è¢«æ¸…ç®—çš„å€Ÿæ¬¾äººæ”¶å–ä¸€ç¬”é¢å¤–çš„<strong>æ¸…ç®—ç½šé‡‘</strong>ï¼Œä¸€éƒ¨åˆ†ç»™åè®®ï¼Œä¸€éƒ¨åˆ†ç»™æ¸…ç®—äººã€‚</li></ul><h2 id="_3-ğŸ’°-æ”¶ç›Šä¸ä½£é‡‘åˆ†é…æœºåˆ¶" tabindex="-1">3 ğŸ’° æ”¶ç›Šä¸ä½£é‡‘åˆ†é…æœºåˆ¶ <a class="header-anchor" href="#_3-ğŸ’°-æ”¶ç›Šä¸ä½£é‡‘åˆ†é…æœºåˆ¶" aria-label="Permalink to &quot;3 ğŸ’° æ”¶ç›Šä¸ä½£é‡‘åˆ†é…æœºåˆ¶&quot;">â€‹</a></h2><h3 id="_3-1-ç”¨æˆ·çš„æ”¶ç›Š-å­˜æ¬¾äºº" tabindex="-1">3.1 ç”¨æˆ·çš„æ”¶ç›Šï¼ˆå­˜æ¬¾äººï¼‰ <a class="header-anchor" href="#_3-1-ç”¨æˆ·çš„æ”¶ç›Š-å­˜æ¬¾äºº" aria-label="Permalink to &quot;3.1 ç”¨æˆ·çš„æ”¶ç›Šï¼ˆå­˜æ¬¾äººï¼‰&quot;">â€‹</a></h3><p>å­˜æ¬¾äººçš„æ”¶ç›Šæ¥æºç›¸å¯¹ç›´æ¥ï¼Œä¸»è¦æ¥è‡ªäºå€Ÿæ¬¾äººæ”¯ä»˜çš„åˆ©æ¯ã€‚</p><ul><li><strong>å­˜æ¬¾åˆ©æ¯</strong>ï¼šæ”¶ç›Šæ¥è‡ªäºå€Ÿæ¬¾äººæ”¯ä»˜çš„åˆ©æ¯ã€‚åˆ©ç‡ç”±<strong>èµ„é‡‘åˆ©ç”¨ç‡ï¼ˆUï¼‰</strong> åŠ¨æ€å†³å®šï¼š<code>U = æ€»å€Ÿæ¬¾ / æ€»å­˜æ¬¾</code>ã€‚ <ul><li>åˆ©ç”¨ç‡è¶Šä½ï¼Œå­˜æ¬¾åˆ©ç‡è¶Šä½ï¼ˆèµ„é‡‘ä¾›ç»™è¿‡å‰©ï¼‰ã€‚</li><li>åˆ©ç”¨ç‡è¶Šé«˜ï¼Œå­˜æ¬¾åˆ©ç‡è¶Šé«˜ï¼ˆèµ„é‡‘éœ€æ±‚æ—ºç››ï¼‰ã€‚</li></ul></li><li><strong>è®¡ç®—æ–¹å¼</strong>ï¼šä½ çš„æ”¶ç›Šä½“ç°åœ¨ä½ æŒæœ‰çš„<strong>è®¡æ¯å‡­è¯ä»£å¸</strong>çš„å¢å€¼ä¸Šã€‚ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒ <code>balanceOfUnderlying(yourAddress)</code> åœ¨ä½ å­˜å…¥æ—¶å’Œç°åœ¨çš„å·®å€¼æ¥è®¡ç®—å…·ä½“æ”¶ç›Šã€‚</li></ul><h3 id="_3-2-å¹³å°çš„æ”¶ç›Š" tabindex="-1">3.2 å¹³å°çš„æ”¶ç›Š <a class="header-anchor" href="#_3-2-å¹³å°çš„æ”¶ç›Š" aria-label="Permalink to &quot;3.2 å¹³å°çš„æ”¶ç›Š&quot;">â€‹</a></h3><p>åè®®çš„æ”¶ç›Šï¼ˆä½£é‡‘ï¼‰å¹¶éç›´æ¥æ”¶å–ï¼Œè€Œæ˜¯é€šè¿‡ç²¾å·§çš„åˆ©ç‡æ¨¡å‹ä»å­˜è´·åˆ©å·®ä¸­äº§ç”Ÿã€‚</p><ul><li><strong>åˆ©å·®ï¼ˆSpreadï¼‰</strong>ï¼šè¿™æ˜¯å¹³å°æœ€æ ¸å¿ƒçš„æ”¶å…¥æ¥æºã€‚åè®®è®¾å®šçš„<strong>å€Ÿæ¬¾åˆ©ç‡ &gt; å­˜æ¬¾åˆ©ç‡</strong>ï¼Œå…¶ä¸­çš„å·®ä»·å³ä¸ºåè®®æ”¶å…¥ã€‚ä¾‹å¦‚ï¼Œå€Ÿæ¬¾åˆ©ç‡ä¸º 5%ï¼Œå­˜æ¬¾åˆ©ç‡ä¸º 4%ï¼Œåˆ™åˆ©å·®ä¸º 1%ã€‚</li><li><strong>æ¸…ç®—ç½šé‡‘åˆ†æˆ</strong>ï¼šå½“å‘ç”Ÿæ¸…ç®—æ—¶ï¼Œå€Ÿæ¬¾äººéœ€è¦æ”¯ä»˜ä¸€ç¬”é¢å¤–çš„ç½šé‡‘ï¼ˆä¾‹å¦‚ï¼ŒæŠµæŠ¼ç‰©ä»·å€¼çš„ 10%ï¼‰ã€‚è¿™ç¬”ç½šé‡‘é€šå¸¸å¤§éƒ¨åˆ†ç»™æ¸…ç®—äººï¼ˆå¦‚ 7.5%ï¼‰ä½œä¸ºæ¿€åŠ±ï¼Œå‰©ä½™éƒ¨åˆ†åˆ™å½’åè®®å›½åº“ï¼ˆå¦‚ 2.5%ï¼‰ã€‚</li><li><strong>å…¶ä»–è´¹ç”¨</strong>ï¼šéƒ¨åˆ†åè®®å¯èƒ½ä¼šå¯¹æç°æˆ–ç‰¹å®šäº¤æ˜“æ”¶å–å°‘é‡å›ºå®šè´¹ç”¨ã€‚</li></ul><h3 id="_3-3-ä½£é‡‘åˆ†é…æ¡ˆä¾‹" tabindex="-1">3.3 ä½£é‡‘åˆ†é…æ¡ˆä¾‹ <a class="header-anchor" href="#_3-3-ä½£é‡‘åˆ†é…æ¡ˆä¾‹" aria-label="Permalink to &quot;3.3 ä½£é‡‘åˆ†é…æ¡ˆä¾‹&quot;">â€‹</a></h3><p>å‡è®¾åè®®åœ¨æŸæ®µæ—¶é—´å†…ï¼š</p><ul><li><strong>æ€»å­˜æ¬¾</strong>ï¼š1000 USDC</li><li><strong>æ€»å€Ÿæ¬¾</strong>ï¼š600 USDC</li><li><strong>èµ„é‡‘åˆ©ç”¨ç‡ (U)</strong>ï¼š60%</li><li><strong>å­˜æ¬¾åˆ©ç‡</strong>ï¼š3% (æ ¹æ® U è®¡ç®—å¾—å‡º)</li><li><strong>å€Ÿæ¬¾åˆ©ç‡</strong>ï¼š4% (æ ¹æ® U è®¡ç®—å¾—å‡º)</li><li><strong>åˆ©å·®</strong>ï¼š1%</li></ul><p><strong>å¹³å°æ”¶ç›Šè®¡ç®—</strong>ï¼š å¹³å°ä½£é‡‘ = æ€»å€Ÿæ¬¾ _ åˆ©å·® = 600 USDC _ 1% = <strong>6 USDC</strong></p><p>è¿™ 6 USDC ä¼šç´¯ç§¯åˆ°åè®®çš„å›½åº“åœ°å€ï¼ˆTreasuryï¼‰ã€‚åè®®æ²»ç†å¯ä»¥å†³å®šå¦‚ä½•ä½¿ç”¨è¿™äº›èµ„é‡‘ï¼ˆå¦‚åˆ†é…ç»™ä»£å¸è´¨æŠ¼è€…ã€ç”¨äºå¼€å‘ã€å›è´­é”€æ¯ä»£å¸ç­‰ï¼‰ã€‚</p><h2 id="_4-âš™ï¸-æŠ€æœ¯å®ç°-å‰åç«¯ä¸æ™ºèƒ½åˆçº¦" tabindex="-1">4 âš™ï¸ æŠ€æœ¯å®ç°ï¼šå‰åç«¯ä¸æ™ºèƒ½åˆçº¦ <a class="header-anchor" href="#_4-âš™ï¸-æŠ€æœ¯å®ç°-å‰åç«¯ä¸æ™ºèƒ½åˆçº¦" aria-label="Permalink to &quot;4 âš™ï¸ æŠ€æœ¯å®ç°ï¼šå‰åç«¯ä¸æ™ºèƒ½åˆçº¦&quot;">â€‹</a></h2><h3 id="_4-1-æ™ºèƒ½åˆçº¦å¼€å‘" tabindex="-1">4.1 æ™ºèƒ½åˆçº¦å¼€å‘ <a class="header-anchor" href="#_4-1-æ™ºèƒ½åˆçº¦å¼€å‘" aria-label="Permalink to &quot;4.1 æ™ºèƒ½åˆçº¦å¼€å‘&quot;">â€‹</a></h3><p>æ™ºèƒ½åˆçº¦æ˜¯åè®®çš„æ ¸å¿ƒï¼Œå…¶è®¾è®¡è‡³å…³é‡è¦ã€‚é€šå¸¸é‡‡ç”¨ç»è¿‡å®¡è®¡çš„ã€æ¨¡å—åŒ–çš„æ¶æ„ã€‚</p><h4 id="_4-1-1-æ ¸å¿ƒåˆçº¦ç»“æ„" tabindex="-1">4.1.1 æ ¸å¿ƒåˆçº¦ç»“æ„ <a class="header-anchor" href="#_4-1-1-æ ¸å¿ƒåˆçº¦ç»“æ„" aria-label="Permalink to &quot;4.1.1 æ ¸å¿ƒåˆçº¦ç»“æ„&quot;">â€‹</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SPDX-License-Identifier: MIT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pragma</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> solidity</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ^0.8.19</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/security/ReentrancyGuard.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/access/Ownable.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¡æ¯å‡­è¯ä»£å¸åˆçº¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">contract</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ownable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReentrancyGuard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SafeERC20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    IERC20 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> immutable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> underlyingAsset;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exchangeRate; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 cToken = X underlying tokens</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onlyOwner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        _mint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to, amount);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ›´æ–°æ±‡ç‡é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> burn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onlyOwner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        _burn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(from, amount);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ›´æ–°æ±‡ç‡é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¸å¿ƒèµ„é‡‘æ± åˆçº¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">contract</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LendingPool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReentrancyGuard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ownable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SafeERC20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Market</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalBorrows;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalSupplies;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> borrowRate;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> supplyRate;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isActive;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cToken cTokenAddress;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Market) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> markets;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userBorrows; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// user -&gt; asset -&gt; amount</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userCollateral; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// user -&gt; asset -&gt; amount</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oracle; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä»·æ ¼é¢„è¨€æœºåœ°å€</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    event</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Deposited</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> asset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    event</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Borrowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> asset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _oracle) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        oracle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _oracle;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deposit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _asset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _amount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonReentrant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> markets[_asset];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(market.isActive, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Market not active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_asset).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safeTransferFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), _amount);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ ¹æ®å½“å‰æ±‡ç‡è®¡ç®—åº”é“¸é€ çš„cTokenæ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cTokensToMint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> market.exchangeRate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        market.cTokenAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cTokensToMint);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        market.totalSupplies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _amount;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        updateInterestRates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_asset);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Deposited</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, _asset, _amount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> borrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _asset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _amount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonReentrant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> markets[_asset];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(market.isActive, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Market not active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ£€æŸ¥å¥åº·å› å­æ˜¯å¦å®‰å…¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_calculateHealthFactor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Health factor too low&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä»èµ„é‡‘æ± ä¸­è½¬å‡ºèµ„äº§ç»™å€Ÿæ¬¾äºº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_asset).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safeTransfer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, _amount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        userBorrows[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][_asset] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        market.totalBorrows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _amount;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        updateInterestRates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_asset);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Borrowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, _asset, _amount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _calculateHealthFactor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _user) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">internal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1. é€šè¿‡é¢„è¨€æœºè·å–ç”¨æˆ·æ‰€æœ‰æŠµæŠ¼ç‰©çš„æ€»ä»·å€¼ï¼ˆUSDï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2. é€šè¿‡é¢„è¨€æœºè·å–ç”¨æˆ·æ‰€æœ‰å€Ÿæ¬¾çš„æ€»ä»·å€¼ï¼ˆUSDï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3. åº”ç”¨æ¸…ç®—é˜ˆå€¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4. è¿”å›: (æ€»æŠµæŠ¼ä»·å€¼ * æ¸…ç®—é˜ˆå€¼) / æ€»å€Ÿæ¬¾ä»·å€¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç®€åŒ–å®ç°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿”å›ä¸€ä¸ªå‡è®¾çš„å®‰å…¨å€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateInterestRates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _asset) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">internal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> market </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> markets[_asset];</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utilizationRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (market.totalBorrows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> market.totalSupplies;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä¸€ä¸ªéå¸¸ç®€åŒ–çš„åˆ©ç‡æ¨¡å‹ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (utilizationRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            market.borrowRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">05e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5%</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            market.supplyRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">04e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4% -&gt; åˆ©å·®1%</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            market.borrowRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">03e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3%</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            market.supplyRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">025e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2.5% -&gt; åˆ©å·®0.5%</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç®¡ç†å‘˜å‡½æ•°ï¼šæ·»åŠ æ–°å¸‚åœº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addMarket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _asset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _cToken) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onlyOwner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        markets[_asset] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Market</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            totalBorrows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            totalSupplies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            borrowRate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            supplyRate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            isActive</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            cTokenAddress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_cToken)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_4-1-2-å®‰å…¨è€ƒé‡" tabindex="-1">4.1.2 å®‰å…¨è€ƒé‡ <a class="header-anchor" href="#_4-1-2-å®‰å…¨è€ƒé‡" aria-label="Permalink to &quot;4.1.2 å®‰å…¨è€ƒé‡&quot;">â€‹</a></h4><ul><li><strong>ä»·æ ¼é¢„è¨€æœº</strong>ï¼š<strong>ç»å¯¹ä¸è¦ä½¿ç”¨å•ä¸€æ¥æºæˆ–å¯æ“çºµçš„ä»·æ ¼</strong>ã€‚å¿…é¡»ä½¿ç”¨å»ä¸­å¿ƒåŒ–çš„é¢„è¨€æœºç½‘ç»œï¼Œå¦‚ Chainlinkï¼Œå¹¶å…·æœ‰é˜²é—ªç”µè´·æ”»å‡»çš„ä¿æŠ¤ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æœ€è¿‘ä¸€æ¬¡çš„ä»·æ ¼è€Œéå®æ—¶ä»·æ ¼ï¼‰ã€‚</li><li><strong>é‡å…¥æ”»å‡»</strong>ï¼šä½¿ç”¨ <code>ReentrancyGuard</code> ä¿®é¥°æ‰€æœ‰å¤–éƒ¨å‡½æ•°ï¼Œå°¤å…¶æ˜¯åœ¨è½¬ç§»ä»£å¸ä¹‹å‰æ›´æ–°çŠ¶æ€ã€‚</li><li><strong>æ•°å­¦è®¡ç®—</strong>ï¼šä½¿ç”¨ Solidity 0.8.x çš„å†…ç½®å®‰å…¨æ•°å­¦ï¼Œæˆ– OpenZeppelin çš„ SafeMath åº“ï¼ˆå¯¹äºæ—§ç‰ˆæœ¬ï¼‰ã€‚</li><li><strong>åˆ©ç‡æ¨¡å‹</strong>ï¼šç¡®ä¿åˆ©ç‡è®¡ç®—ä¸ä¼šå¯¼è‡´æº¢å‡ºæˆ–è¢«æ¶æ„æ“çºµã€‚</li><li><strong>æ¸…ç®—æ¿€åŠ±</strong>ï¼šæ¸…ç®—ç³»ç»Ÿå¿…é¡»è®¾è®¡å¾—å½“ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„æ¿€åŠ±è®©æ¸…ç®—äººåŠæ—¶æ¸…ç®—ï¼ŒåŒæ—¶é¿å…è¿‡åº¦æƒ©ç½šå€Ÿæ¬¾äººã€‚</li></ul><h3 id="_4-2-åç«¯å¼€å‘" tabindex="-1">4.2 åç«¯å¼€å‘ <a class="header-anchor" href="#_4-2-åç«¯å¼€å‘" aria-label="Permalink to &quot;4.2 åç«¯å¼€å‘&quot;">â€‹</a></h3><p>åç«¯ä¸»è¦è´Ÿè´£ç´¢å¼•é“¾ä¸Šæ•°æ®å¹¶æä¾›æ˜“äºæŸ¥è¯¢çš„ APIã€‚</p><ul><li><strong>æŠ€æœ¯æ ˆ</strong>ï¼šNode.js + Express/NestJS, Python + FastAPI, æˆ– Goã€‚æ•°æ®åº“å¸¸ç”¨ PostgreSQL æˆ– MongoDBã€‚</li><li><strong>æ ¸å¿ƒä»»åŠ¡</strong>ï¼š <ul><li><strong>ç´¢å¼•äº‹ä»¶</strong>ï¼šä½¿ç”¨<code>ethers.js</code>/<code>web3.py</code>ç›‘å¬å¹¶ç´¢å¼•åˆçº¦ä¸­çš„<code>Deposited</code>ã€<code>Borrowed</code>ã€<code>Liquidated</code>ç­‰äº‹ä»¶ï¼Œå°†å…¶å­˜å…¥æ•°æ®åº“ã€‚</li><li><strong>è®¡ç®—èšåˆæ•°æ®</strong>ï¼šè®¡ç®—å¹¶ç¼“å­˜å…¨å±€æ•°æ®ï¼Œå¦‚æ€»é”ä»“é‡ï¼ˆTVLï¼‰ã€å„å¸‚åœºåˆ©ç‡ã€å¹³å°æ€»æ”¶å…¥ç­‰ã€‚è¿™äº›æ•°æ®åœ¨é“¾ä¸Šè®¡ç®—å¯èƒ½éå¸¸æ˜‚è´µã€‚</li><li><strong>æä¾› API</strong>ï¼š <ul><li><code>GET /markets</code>: è¿”å›æ‰€æœ‰å¸‚åœºè¯¦æƒ…ï¼ˆå­˜æ¬¾é‡ã€å€Ÿæ¬¾é‡ã€åˆ©ç‡ç­‰ï¼‰ã€‚</li><li><code>GET /users/:address</code>: è¿”å›ç”¨æˆ·å¤´å¯¸è¯¦æƒ…ï¼ˆå­˜æ¬¾ã€å€Ÿæ¬¾ã€å¥åº·å› å­ï¼‰ã€‚</li></ul></li><li><strong>ç›‘æ§å¥åº·å› å­</strong>ï¼šå¯ä»¥è¿è¡Œåå°ä»»åŠ¡ç›‘æ§æ‰€æœ‰ç”¨æˆ·çš„é£é™©æŒ‡æ ‡ï¼Œå¹¶ä¸ºæ¥è¿‘æ¸…ç®—çš„ç”¨æˆ·æä¾›é¢„è­¦ï¼ˆå¯é€‰ï¼‰ã€‚</li></ul></li></ul><h3 id="_4-3-å‰ç«¯å¼€å‘" tabindex="-1">4.3 å‰ç«¯å¼€å‘ <a class="header-anchor" href="#_4-3-å‰ç«¯å¼€å‘" aria-label="Permalink to &quot;4.3 å‰ç«¯å¼€å‘&quot;">â€‹</a></h3><p>å‰ç«¯æ˜¯ç”¨æˆ·äº¤äº’çš„çª—å£ï¼Œéœ€è¦æ¸…æ™°å±•ç¤ºå¤æ‚ä¿¡æ¯å¹¶ç¡®ä¿äº¤æ˜“å®‰å…¨ã€‚</p><ul><li><strong>æŠ€æœ¯æ ˆ</strong>ï¼šReactï¼ˆä¸»æµï¼‰æˆ– Vue.jsï¼Œæ­é… Ethers.js æˆ– Viemï¼ˆæ–°ä¸€ä»£ Web3 åº“ï¼‰ã€‚</li><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š <ul><li><strong>é’±åŒ…é›†æˆ</strong>ï¼šæ— ç¼è¿æ¥ MetaMaskã€WalletConnect ç­‰ï¼Œè·å–ç”¨æˆ·åœ°å€å’Œä½™é¢ã€‚</li><li><strong>æ•°æ®å±•ç¤º</strong>ï¼šä»åç«¯ API å’Œé“¾ä¸Šåˆçº¦è·å–æ•°æ®ï¼Œå±•ç¤ºå¸‚åœºåˆ—è¡¨ã€ç”¨æˆ·å¤´å¯¸ã€èµ„äº§ä»·æ ¼ã€å¥åº·å› å­ç­‰ã€‚</li><li><strong>åˆçº¦äº¤äº’</strong>ï¼šæ„å»ºäº¤æ˜“ä»¥è°ƒç”¨<code>deposit</code>ã€<code>borrow</code>ã€<code>repay</code>ç­‰æ–¹æ³•ã€‚æ¸…æ™°æ˜¾ç¤º Gas è´¹é¢„ä¼°ã€‚</li><li><strong>äº¤æ˜“çŠ¶æ€åé¦ˆ</strong>ï¼šæä¾›äº¤æ˜“çŠ¶æ€ï¼ˆç¡®è®¤ä¸­ã€æˆåŠŸ/å¤±è´¥ï¼‰å’ŒåŒºå—é“¾æµè§ˆå™¨é“¾æ¥ã€‚</li><li><strong>é£é™©ç®¡ç†</strong>ï¼šåœ¨ç”¨æˆ·è¿›è¡Œé«˜é£é™©æ“ä½œï¼ˆå¦‚å€Ÿæ¬¾å¯¼è‡´å¥åº·å› å­è¿‡ä½ï¼‰æ—¶ç»™å‡ºå¼ºçƒˆè­¦å‘Šã€‚</li></ul></li></ul>`,39)]))}const o=i(t,[["render",k]]);export{y as __pageData,o as default};
