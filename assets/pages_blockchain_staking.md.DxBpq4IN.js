import{_ as i,c as a,o as n,ao as t}from"./chunks/framework.DOhyS95j.js";const l="/handbook/assets/staking.utbRfvkv.png",y=JSON.parse('{"title":"🔗 质押挖矿系统：流程、收益机制与开发实现","description":"","frontmatter":{},"headers":[],"relativePath":"pages/blockchain/staking.md","filePath":"pages/blockchain/staking.md"}'),h={name:"pages/blockchain/staking.md"};function k(p,s,e,r,E,d){return n(),a("div",null,s[0]||(s[0]=[t('<h1 id="🔗-质押挖矿系统-流程、收益机制与开发实现" tabindex="-1">🔗 质押挖矿系统：流程、收益机制与开发实现 <a class="header-anchor" href="#🔗-质押挖矿系统-流程、收益机制与开发实现" aria-label="Permalink to &quot;🔗 质押挖矿系统：流程、收益机制与开发实现&quot;">​</a></h1><h2 id="_1-⛓️-质押挖矿系统概述" tabindex="-1">1 ⛓️ 质押挖矿系统概述 <a class="header-anchor" href="#_1-⛓️-质押挖矿系统概述" aria-label="Permalink to &quot;1 ⛓️ 质押挖矿系统概述&quot;">​</a></h2><p>质押挖矿（Staking Mining）是 DeFi 领域的核心模式之一，它允许用户通过锁定加密资产（如代币、LP 代币或 NFT）来参与网络验证或流动性提供，从而获得奖励。其核心优势在于它<strong>无需传统 PoW 挖矿的昂贵矿机和能源消耗</strong>，同时能为用户提供持续收益，并为区块链网络的安全性和流动性做出贡献。</p><p>一个典型的质押挖矿系统通常包含以下核心组件：</p><ul><li><strong>智能合约层</strong>：负责处理所有核心逻辑，如质押、收益计算、奖励发放等，通常部署在区块链上（如 Ethereum, BSC, Solana 等）。</li><li><strong>用户交互层（前端）</strong>：提供用户界面，方便用户进行质押、解押、查看收益等操作，并通过钱包与区块链交互。</li><li><strong>后端服务层</strong>：处理链下数据索引、任务管理、通知推送等，有时也用于复杂的计算以减轻链上负担。</li><li><strong>资产管理层</strong>：负责安全地托管用户资产（通常通过多重签名钱包或冷钱包）。</li></ul><h2 id="_2-🔄-完整的质押流程" tabindex="-1">2 🔄 完整的质押流程 <a class="header-anchor" href="#_2-🔄-完整的质押流程" aria-label="Permalink to &quot;2 🔄 完整的质押流程&quot;">​</a></h2><p>一个用户参与质押挖矿的完整流程通常涉及以下步骤，下图描绘了核心的参与路径和系统内部处理过程：</p><p><img src="'+l+`" alt="质押流程"></p><h3 id="_2-1-用户参与流程" tabindex="-1">2.1 用户参与流程 <a class="header-anchor" href="#_2-1-用户参与流程" aria-label="Permalink to &quot;2.1 用户参与流程&quot;">​</a></h3><p>首先是用户的前端交互和质押操作：</p><ol><li><strong>连接钱包</strong>：用户首先需要通过 Web3 钱包（如 MetaMask、Trust Wallet）与质押平台的前端界面连接。这是用户与区块链交互的入口。</li><li><strong>授权代币</strong>：在首次质押某种代币前，用户需要授权平台的智能合约在一定数量下操作其代币。这是一笔独立的区块链交易，需要支付 Gas 费。</li><li><strong>执行质押</strong>：用户选择质押数量并确认交易。质押操作本身也是一笔区块链交易，需要用户签名并支付 Gas 费。部分平台可能支持<strong>质押即挖矿</strong>，用户在质押的同时就开始积累挖矿奖励。</li></ol><h3 id="_2-2-合约与后端处理" tabindex="-1">2.2 合约与后端处理 <a class="header-anchor" href="#_2-2-合约与后端处理" aria-label="Permalink to &quot;2.2 合约与后端处理&quot;">​</a></h3><p>在用户发起质押交易后，智能合约和后端服务会进行以下处理：</p><ol><li><strong>智能合约处理</strong>： <ul><li>合约在收到质押交易后，会执行 <code>stake</code> 函数，将用户的代币从其地址转移到合约地址中锁定。</li><li>合约会更新内部状态变量，记录用户的质押余额和质押开始时间（或其他用于计算收益的关键参数）。</li><li>合约通常会<strong>触发一个质押事件（Stake Event）</strong>，以便前端和后端监听并响应。</li></ul></li><li><strong>后端服务监听</strong>： <ul><li>后端服务器（通常使用 Node.js、Go、Python 等）会持续监听区块链上智能合约发出的事件。</li><li>当检测到新的质押事件时，后端会解析事件数据，并将相关信息（如用户地址、质押数量、时间戳）存入数据库（如 MongoDB、PostgreSQL），以便后续查询和展示。</li></ul></li></ol><h2 id="_3-💰-收益与佣金分配机制" tabindex="-1">3 💰 收益与佣金分配机制 <a class="header-anchor" href="#_3-💰-收益与佣金分配机制" aria-label="Permalink to &quot;3 💰 收益与佣金分配机制&quot;">​</a></h2><h3 id="_3-1-用户的收益来源与计算" tabindex="-1">3.1 用户的收益来源与计算 <a class="header-anchor" href="#_3-1-用户的收益来源与计算" aria-label="Permalink to &quot;3.1 用户的收益来源与计算&quot;">​</a></h3><p>用户的收益并非单一来源，平台可以通过多种方式激励用户质押。</p><table tabindex="0"><thead><tr><th style="text-align:left;">收益类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">计算方式举例</th><th style="text-align:left;">参考来源</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>固定利率奖励</strong></td><td style="text-align:left;">根据质押资产价值和预先设定的年化收益率（APY）计算。</td><td style="text-align:left;">若 APY 为 5%，用户质押 100 USDT，一年收益约为 5 USDT。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><strong>浮动利率奖励</strong></td><td style="text-align:left;">收益率根据市场策略、资金池利用率等因素动态调整。</td><td style="text-align:left;">参考 Spark Protocol 等货币市场协议，收益率会随供需变化。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><strong>交易手续费分成</strong></td><td style="text-align:left;">用户质押 LP Token 后，可按比例分享相关交易对的交易手续费。</td><td style="text-align:left;">收益 = (用户质押的 LP 数量 / 总质押的 LP 数量) * 期间产生的总手续费。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><strong>平台代币激励</strong></td><td style="text-align:left;">许多项目会额外发行原生代币奖励质押用户，是其常见激励方式。</td><td style="text-align:left;">用户除基础资产收益外，还可按质押权重获得平台代币。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><strong>协议收入分成</strong></td><td style="text-align:left;">部分项目会将平台部分收入（如 NFT 销售佣金、广告收入）分配给质押用户。</td><td style="text-align:left;">如 VCGamers 将 NFT 销售佣金、广告收入的 25%-75%分配给质押池。StreamFlow 将协议收入直接转化为 Staking 奖励。</td><td style="text-align:left;"></td></tr></tbody></table><p>收益的计算与发放主要有两种模式：</p><ul><li><strong>自动复利计算</strong>：通常在每个区块或特定时间间隔，通过合约公式动态更新用户的累计收益额。 <code>待领取奖励 = 质押金额 * (当前总奖励因子 / 用户个人奖励因子)</code> （简化模型，需在合约内维护因子状态）</li><li><strong>按区块/时间计算</strong>：<code>用户收益 = (用户质押量 / 总质押量) * 区块奖励 * 时间间隔</code></li></ul><p>收益的发放也可以是<strong>自动发放</strong>（如每日自动结算并复投或发放）或<strong>手动领取</strong>（用户主动调用合约的<code>claim</code>函数支付 Gas 费提取奖励）。</p><h3 id="_3-2-平台的收益-佣金-模式" tabindex="-1">3.2 平台的收益（佣金）模式 <a class="header-anchor" href="#_3-2-平台的收益-佣金-模式" aria-label="Permalink to &quot;3.2 平台的收益（佣金）模式&quot;">​</a></h3><p>平台的可持续运营依赖于从用户的收益中抽取一部分作为佣金。常见的佣金模式包括：</p><ul><li><strong>对用户收益抽成</strong>：这是最常见的方式。平台<strong>直接从用户获得的挖矿奖励中抽取一定比例</strong>（例如 10%）作为手续费。这部分佣金有时会用于回购平台代币、分红给平台代币质押者，或注入金库支持生态发展。</li><li><strong>协议收入分配</strong>：部分平台协议本身会产生收入（如交易费、广告费、NFT 销售佣金），这些收入会按预定比例一部分分配给质押者，另一部分则进入平台国库（Company Treasury）作为运营收入。</li><li><strong>其他隐性收益</strong>：庞大的质押资金池可以提升平台的<strong>知名度和锁仓价值（TVL）</strong>，从而可能推高平台代币价格，也为平台后续开展其他业务（如借贷、衍生品）提供了基础。</li></ul><h3 id="_3-3-佣金分配案例" tabindex="-1">3.3 佣金分配案例 <a class="header-anchor" href="#_3-3-佣金分配案例" aria-label="Permalink to &quot;3.3 佣金分配案例&quot;">​</a></h3><p>假设某平台采用如下分成结构：</p><ul><li>用户通过质押某代币，获得了 100 USDT 的奖励。</li><li>平台佣金比例为 10%。</li><li>最终，用户实际获得 90 USDT，平台获得 10 USDT 作为佣金。</li></ul><p>平台获得的 10 USDT 佣金可能会进一步内部划分：</p><ul><li><strong>50%</strong>（即 5 USDT）用于回购并销毁平台代币（通缩模型）。</li><li><strong>30%</strong>（即 3 USDT）分配给那些质押了平台原生代币的用户（激励持有）。</li><li><strong>20%</strong>（即 2 USDT）进入开发基金，用于项目持续开发和运营。</li></ul><h2 id="_4-⚙️-技术实现-前后端与智能合约" tabindex="-1">4 ⚙️ 技术实现：前后端与智能合约 <a class="header-anchor" href="#_4-⚙️-技术实现-前后端与智能合约" aria-label="Permalink to &quot;4 ⚙️ 技术实现：前后端与智能合约&quot;">​</a></h2><h3 id="_4-1-智能合约开发" tabindex="-1">4.1 智能合约开发 <a class="header-anchor" href="#_4-1-智能合约开发" aria-label="Permalink to &quot;4.1 智能合约开发&quot;">​</a></h3><p>智能合约是质押挖矿系统的核心，其安全性至关重要。</p><h4 id="_4-1-1-关键合约结构与函数" tabindex="-1">4.1.1 关键合约结构与函数 <a class="header-anchor" href="#_4-1-1-关键合约结构与函数" aria-label="Permalink to &quot;4.1.1 关键合约结构与函数&quot;">​</a></h4><p>通常采用经过审计的库（如 OpenZeppelin）来构建合约。</p><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SPDX-License-Identifier: MIT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pragma</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> solidity</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ^0.8.19</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/security/ReentrancyGuard.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@openzeppelin/contracts/access/Ownable.sol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">contract</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StakingPool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> is</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReentrancyGuard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ownable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    IERC20 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> immutable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stakingToken; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 质押的代币</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    IERC20 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> immutable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewardToken;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 奖励的代币（可能与质押代币相同）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> constant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REWARD_RATE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 每秒奖励率，可根据需要调整</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalStaked;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 总质押量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastUpdateTime;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 上次更新奖励的时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewardPerTokenStored;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 累计每token奖励</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userStakedBalance; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户质押余额</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userRewardPerTokenPaid; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户已结算的每token奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewards;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户待领取奖励</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    event</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Staked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    event</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Withdrawn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    event</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RewardPaid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> indexed</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _stakingToken, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _rewardToken) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stakingToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_stakingToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rewardToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IERC20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_rewardToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 核心：更新用户的累计奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    modifier</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> account</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rewardPerTokenStored </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rewardPerToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lastUpdateTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.timestamp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (account </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            rewards[account] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> earned</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(account);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            userRewardPerTokenPaid[account] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewardPerTokenStored;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        _</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 计算累计的每token奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rewardPerToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (totalStaked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewardPerTokenStored;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewardPerTokenStored </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               (((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.timestamp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastUpdateTime) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REWARD_RATE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalStaked);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 查询用户已赚取的奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> earned</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> account</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((userStakedBalance[account] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rewardPerToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userRewardPerTokenPaid[account])) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                rewards[account];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 质押函数（外部入口）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stake</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonReentrant</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cannot stake 0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        totalStaked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        userStakedBalance[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stakingToken.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transferFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), amount);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Staked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, amount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 提取质押本金</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> withdraw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">uint256</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonReentrant</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cannot withdraw 0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        totalStaked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        userStakedBalance[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stakingToken.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transfer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, amount);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Withdrawn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, amount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 领取奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonReentrant</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rewards[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (reward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            rewards[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 平台佣金抽成：假设10%，实际发放90%</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platformFee </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1000 basis points = 10%</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userReward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platformFee;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            rewardToken.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transfer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, userReward);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            rewardToken.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transfer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">owner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), platformFee); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 平台佣金转给所有者</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RewardPaid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, userReward);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 退出：提取所有本金并领取奖励</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        withdraw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userStakedBalance[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg.sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        getReward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_4-1-2-安全考量" tabindex="-1">4.1.2 安全考量 <a class="header-anchor" href="#_4-1-2-安全考量" aria-label="Permalink to &quot;4.1.2 安全考量&quot;">​</a></h4><p>智能合约的安全是重中之重，必须考虑以下方面：</p><ul><li><strong>重入攻击防护</strong>：使用 <code>ReentrancyGuard</code> 修饰关键函数（如<code>withdraw</code>, <code>getReward</code>），防止递归调用。</li><li><strong>数学溢出/下溢</strong>：Solidity 0.8.x 版本内置了溢出检查，但如果使用较低版本，则需引入 SafeMath 库。</li><li><strong>权限控制</strong>：使用 <code>Ownable</code> 或 <code>AccessControl</code> 库管理关键功能（如提取意外发送的代币、调整收益率等）的访问权限。</li><li><strong>代币授权风险</strong>：提醒用户只授权必要的数量，而非无限授权。</li><li><strong>专业审计</strong>：在部署到主网之前，<strong>务必聘请专业的智能合约审计公司</strong>（如 CertiK, Quantstamp, ConsenSys Diligence）对代码进行彻底审计。</li></ul><h3 id="_4-2-后端开发" tabindex="-1">4.2 后端开发 <a class="header-anchor" href="#_4-2-后端开发" aria-label="Permalink to &quot;4.2 后端开发&quot;">​</a></h3><p>后端主要负责链下数据的处理和提供 API 支持。</p><ul><li><strong>技术栈选择</strong>：Node.js（擅长事件驱动和 I/O 密集型应用）、Go（高性能）、Python（开发速度快）是常见选择。数据库可使用 MongoDB（存储灵活的链下数据）、PostgreSQL 或 TimescaleDB（用于时间序列数据，如历史收益率）。</li><li><strong>核心功能</strong>： <ul><li><strong>事件监听</strong>：使用 Web3.js 或 Ethers.js 库监听区块链事件，如 <code>Staked</code>, <code>Withdrawn</code>, <code>RewardPaid</code>，并将相关数据索引到数据库。</li><li><strong>数据聚合与 API</strong>：提供 RESTful 或 GraphQL API，为前端提供复杂查询，如用户历史质押记录、总锁仓量（TVL）变化、平台历史佣金收入等。这些计算在链下进行更经济。</li><li><strong>计算预估 APY</strong>：根据当前合约状态和区块链数据，实时计算并更新预估年化收益率，供前端显示。</li><li><strong>定时任务</strong>：可能需要处理一些链下奖励或通知。</li></ul></li></ul><h3 id="_4-3-前端开发" tabindex="-1">4.3 前端开发 <a class="header-anchor" href="#_4-3-前端开发" aria-label="Permalink to &quot;4.3 前端开发&quot;">​</a></h3><p>前端是用户直接交互的界面，需要简洁易用且安全。</p><ul><li><strong>技术栈</strong>：React 或 Vue.js 是主流框架。通过 Web3.js、Ethers.js 或更高级的封装库（如 useDapp、Web3-react）与钱包和智能合约交互。</li><li><strong>核心功能</strong>： <ul><li><strong>钱包集成</strong>：无缝集成 MetaMask、WalletConnect、Trust Wallet 等常见钱包，处理账户连接、切换网络、交易签名等。</li><li><strong>合约交互</strong>：调用合约的读写方法。读操作（如查询余额、收益）免费，写操作（质押、解押、领取）会触发交易，需要用户支付 Gas 费并确认。</li><li><strong>数据展示</strong>：清晰展示用户的质押余额、待领取奖励、历史记录、当前收益率等数据。这些数据通常通过调用后端 API 或直接读取合约获得。</li><li><strong>交易状态反馈</strong>：友好地显示交易状态（等待中、确认中、成功/失败），提供区块链浏览器交易哈希的链接。</li></ul></li></ul>`,44)]))}const o=i(h,[["render",k]]);export{y as __pageData,o as default};
