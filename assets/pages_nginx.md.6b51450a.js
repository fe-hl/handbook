import{_ as n,c as a,o as l,O as p}from"./chunks/framework.a45091be.js";const s="/handbook/assets/nginx1.db884010.png",u=JSON.parse('{"title":"nginx","description":"","frontmatter":{},"headers":[],"relativePath":"pages/nginx.md","lastUpdated":1712560789000}'),o={name:"pages/nginx.md"},e=p('<h1 id="nginx" tabindex="-1">nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;nginx&quot;">​</a></h1><h2 id="nginx-正向代理" tabindex="-1">nginx 正向代理 <a class="header-anchor" href="#nginx-正向代理" aria-label="Permalink to &quot;nginx 正向代理&quot;">​</a></h2><ul><li>代理的用户请求，和用户请求方向一致，叫做正向代理。</li></ul><p><img src="'+s+'" alt="正向代理"></p><h2 id="nginx-反向代理" tabindex="-1">nginx 反向代理 <a class="header-anchor" href="#nginx-反向代理" aria-label="Permalink to &quot;nginx 反向代理&quot;">​</a></h2><ul><li>代理是代理服务器处理用户请求，和用户请求方向相反，叫做反向代理。 <img src="'+s+`" alt="反向代理"></li></ul><h2 id="nginx-全局设置优化" tabindex="-1">nginx 全局设置优化 <a class="header-anchor" href="#nginx-全局设置优化" aria-label="Permalink to &quot;nginx 全局设置优化&quot;">​</a></h2><ul><li><p>worker_processes 用来设置 Nginx 服务的进程数。推荐是 CPU 内核数或者内核数的倍数，推荐使用 CPU 内核数</p><blockquote><p>worker_processes 4;</p></blockquote></li><li><p>默认情况下，Nginx 的多个进程有可能跑在某一个 CPU 或 CPU 的某一核上，导致 Nginx 进程使用硬件的资源不均</p><blockquote><p>worker_cpu_affinity 0001 0010 0100 1000;</p></blockquote></li><li><p>设置一个进程理论允许的最大连接数，理论上越大越好，但不可以超过 worker_rlimit_nofile 的值</p><blockquote><p>worker_rlimit_nofile 200000;</p></blockquote></li></ul><h2 id="查看服务器最大可以打开文件的数量" tabindex="-1">查看服务器最大可以打开文件的数量 <a class="header-anchor" href="#查看服务器最大可以打开文件的数量" aria-label="Permalink to &quot;查看服务器最大可以打开文件的数量&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ulimit </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">a 查看</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ulimit </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">n </span><span style="color:#F78C6C;">300000</span><span style="color:#A6ACCD;">  更改</span></span></code></pre></div><h2 id="升级-http2" tabindex="-1">升级 http2 <a class="header-anchor" href="#升级-http2" aria-label="Permalink to &quot;升级 http2&quot;">​</a></h2><ul><li>1、nginx 的版本必须在 1.9.5 以上</li><li>2、openssl 的版本必须在 1.0.2e 及以上</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">listen</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">443</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ssl</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="nginx-模块" tabindex="-1">nginx 模块 <a class="header-anchor" href="#nginx-模块" aria-label="Permalink to &quot;nginx 模块&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#nginx进程数，建议设置为等于CPU总核心数</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_processes  </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#全局错误日志定义类型，[ debug </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> info </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> notice </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> warn </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> error </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> crit ]</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log  logs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 一个nginx进程打开的最多文件</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_rlimit_nofile </span><span style="color:#F78C6C;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#工作模式与连接数上限</span></span>
<span class="line"><span style="color:#A6ACCD;">events </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   # </span><span style="color:#A6ACCD;">单个进程最大连接数</span><span style="color:#F07178;">（</span><span style="color:#A6ACCD;">最大连接数</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">连接数</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">进程数</span><span style="color:#F07178;">）</span><span style="color:#A6ACCD;">该值受系统进程最大打开文件数限制</span><span style="color:#F07178;">，</span><span style="color:#A6ACCD;">需要使用命令ulimit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">查看当前设置</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">worker_connections</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#设定http服务器</span></span>
<span class="line"><span style="color:#A6ACCD;">http </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">长连接超时时间</span><span style="color:#F07178;">，</span><span style="color:#A6ACCD;">单位是秒</span><span style="color:#F07178;">，</span><span style="color:#A6ACCD;">默认为0</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">keepalive_timeout</span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">65</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    # </span><span style="color:#A6ACCD;">gzip压缩功能设置</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">gzip</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> #</span><span style="color:#A6ACCD;">开启gzip压缩输出</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">gzip_comp_level</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> #</span><span style="color:#A6ACCD;">压缩等级</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">gzip_types</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">application</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">javascript</span><span style="color:#F07178;"> # </span><span style="color:#A6ACCD;">类型不配置不生效</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    # </span><span style="color:#A6ACCD;">http_proxy服务全局设置</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">client_max_body_size</span><span style="color:#F07178;">   10</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">   # </span><span style="color:#A6ACCD;">设定负载均衡后台服务器列表</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">upstream</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">backend</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;">   </span><span style="color:#F78C6C;">192.168</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">10.100</span><span style="color:#F07178;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">30</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;">   </span><span style="color:#F78C6C;">192.168</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">10.101</span><span style="color:#F07178;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">30</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">虚拟主机的配置</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        #</span><span style="color:#A6ACCD;">监听端口</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">listen</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        #</span><span style="color:#A6ACCD;">域名可以有多个</span><span style="color:#F07178;">，</span><span style="color:#A6ACCD;">用空格隔开</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">server_name</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">localhost</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fontend</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        #</span><span style="color:#A6ACCD;">代理</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">location</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">proxy_pass</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//127.0.0.1:3000;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">       # </span><span style="color:#A6ACCD;">图片缓存时间设置</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#A6ACCD;">location</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">~</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">.*.</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">gif</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">jpg</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">jpeg</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">png</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">bmp</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">swf</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">$</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">expires</span><span style="color:#F07178;"> 10</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">       # </span><span style="color:#A6ACCD;">JS和CSS缓存时间设置</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#A6ACCD;">location</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">~</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">.*.</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">js</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">css</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">$</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          expires 1h;</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h2 id="cors-分类-简单请求和非简单请求" tabindex="-1">CORS 分类(简单请求和非简单请求) <a class="header-anchor" href="#cors-分类-简单请求和非简单请求" aria-label="Permalink to &quot;CORS 分类(简单请求和非简单请求)&quot;">​</a></h2><h3 id="简单请求" tabindex="-1">简单请求 <a class="header-anchor" href="#简单请求" aria-label="Permalink to &quot;简单请求&quot;">​</a></h3><ul><li><p>1、请求方法是以下三种方法之一:<code>HEAD</code> <code>GET</code> <code>POST</code></p></li><li><p>2、HTTP的头信息不超出以下几种字段:</p><blockquote><p>Accept</p></blockquote><blockquote><p>Accept-Language</p></blockquote><blockquote><p>Content-Language</p></blockquote><blockquote><p>Last-Event-ID</p></blockquote><blockquote><p>Content-Type：只限于三个值a<code>pplication/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></p></blockquote></li></ul><h3 id="非简单请求" tabindex="-1">非简单请求 <a class="header-anchor" href="#非简单请求" aria-label="Permalink to &quot;非简单请求&quot;">​</a></h3><ul><li><p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT、DELETE或OPTIONS，或者Content-Type字段的类型是application/json。</p></li><li><p>对于非简单 CORS 请求会有一个预检机制，预捡的请求方法是 OPTIONS，如果不做处理状态码会返回 403 或者 405，我们需要在 nginx 对 OPTIONS 方法进行处理让状态码返回 200</p></li></ul><h2 id="cors-配置" tabindex="-1">CORS 配置 <a class="header-anchor" href="#cors-配置" aria-label="Permalink to &quot;CORS 配置&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">location </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">add_header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// 跨域白名单</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">add_header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Methods</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET, POST, OPTIONS, PUT, DELETE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">add_header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">   # </span><span style="color:#A6ACCD;">处理非简单请求</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">$request_method</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">OPTIONS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="nginx-基础配置" tabindex="-1">nginx 基础配置 <a class="header-anchor" href="#nginx-基础配置" aria-label="Permalink to &quot;nginx 基础配置&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">user  nginx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_processes  </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">include </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">usr</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">share</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">mod</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">conf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">error_log  </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/log/nginx/error.log warn</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">pid        </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/run/nginx.pid</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">events </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">worker_connections</span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">http </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">include</span><span style="color:#F07178;">       </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">mime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">default_type</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">application</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">octet</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">server_tokens</span><span style="color:#F07178;">       </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">proxy_intercept_errors</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">   #</span><span style="color:#A6ACCD;">log_format</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">main</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$remote_addr - $remote_user [$time_local] &quot;$request&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">   #                  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$status $body_bytes_sent &quot;$http_referer&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">   #                  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">log_format</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">main</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$remote_addr - $remote_user [$time_local] &quot;$request&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$status $body_bytes_sent &quot;$http_referer&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;$http_host&quot; &quot;$upstream_addr&quot; &quot;$upstream_status&quot; &quot;$upstream_response_time&quot; &quot;$request_time&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">access_log</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#F07178;">/</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">/nginx/access.log  main</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">client_max_body_size</span><span style="color:#F07178;"> 100</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">sendfile</span><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">tcp_nopush</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">keepalive_timeout</span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">65</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">gzip</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">   #</span><span style="color:#A6ACCD;">large_client_header_buffers</span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;"> 1</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">conf</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#676E95;font-style:italic;">/*.conf;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=10r/s;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">stream {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    log_format  basic   &#39;$time_iso8601 $remote_addr &#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                        &#39;$protocol $status $bytes_sent $bytes_received &#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                        &#39;$session_time $upstream_addr &#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                        &#39;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    access_log      /var/log/nginx/stream.log  basic buffer=1k flush=5s;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    include /etc/nginx/conf.d/*.tcp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">}</span></span></code></pre></div><h2 id="静态资料配置" tabindex="-1">静态资料配置 <a class="header-anchor" href="#静态资料配置" aria-label="Permalink to &quot;静态资料配置&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">listen</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">50080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">server_name</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">		#</span><span style="color:#A6ACCD;">charset</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">koi8</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">r</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		#</span><span style="color:#A6ACCD;">access_log</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">logs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">access</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">		</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">location</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">internet_payment_account</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">alias</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">usr</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">share</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">frontapp</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">internet_payment_account</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">try_files</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">$uri</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">$uri</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">internet_payment_account</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">location</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">ipa</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">bizcenter</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">api</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">client_max_body_size</span><span style="color:#F07178;"> 50</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">proxy_pass</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//10.123.78.82:8001/ipa-bizcenter;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">                      </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,26),t=[e];function c(r,y,D,F,i,C){return l(),a("div",null,t)}const d=n(o,[["render",c]]);export{u as __pageData,d as default};
